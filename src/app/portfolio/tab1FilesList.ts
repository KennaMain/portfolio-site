export const imagePaths: string[] = [
  "/projects/patterns/main_w1 2.jpg",
  "/projects/patterns/pattern6.jpg",
  "/projects/patterns/horseshoecrab.jpg",
  "/projects/patterns/diatoms.jpg",
  "/projects/patterns/kennamain_pattern_1.jpg",
  "/projects/patterns/radiolarian.jpg",
  "/projects/patterns/cuttlefish.jpg",
  "/projects/metamorphic/main_metamorphic.jpg",
  "/projects/metamorphic/TRANSFORMER poster.jpg",
  "/projects/metamorphic/shapeshifter poster.jpg",
  "/projects/metamorphic/metamorphic poster final.jpg",
  "/projects/Gauache/main_poster_art.jpg",
  "/projects/bookstore/bookposter2.jpg",
  "/projects/bookstore/bookposter3.jpg",
  "/projects/bookstore/bookposter1.jpg",
  "/projects/bookstore/Three_Posters_In_Metal_Frames.jpg",
  "/projects/make a discovery/make4.jpg",
  "/projects/make a discovery/make5.jpg",
  "/projects/make a discovery/make7.jpg",
  "/projects/make a discovery/make6.jpg",
  "/projects/make a discovery/make2.jpg",
  "/projects/make a discovery/makefront.jpg",
  "/projects/make a discovery/make3.jpg",
  "/projects/make a discovery/IMG_7681.jpg",
  "/projects/make a discovery/IMG_7678.jpg",
  "/projects/make a discovery/make.glb",
  "/projects/park wayfinding/softball4.jpg",
  "/projects/park wayfinding/softball3.jpg",
  "/projects/park wayfinding/softball2.jpg",
  "/projects/park wayfinding/softball1.jpg",
  "/projects/park wayfinding/park_signs.jpg",
  "/projects/pompeiiworm_inforgraphic/pompeii infographic.pdf",
  "/projects/lbtp/lbtp_direwolf_sticker.jpg",
  "/projects/lbtp/KennaMain_TshirtMockupfront_ 2.jpg",
  "/projects/lbtp/lbtp_poster.jpg",
  "/projects/lbtp/KennaMain_PinMockup.jpg",
  "/projects/lbtp/KennaMain_TicketMockup.jpg",
  "/projects/lbtp/lbtp_wordlockup.svg",
  "/projects/lbtp/KennaMain_TshirtMockupback_2.jpg",
  "/projects/lbtp/KennaMain_ToteBag_Mockup_2.jpg",
  "/projects/lbtp/lbtp_symbol.svg",
  "/projects/lbtp/KennaMain_Sticker_Mockup_2.jpg",
  "/projects/lbtp/KennaMain_ToteBag_Mockup_1.jpg",
  "/projects/lbtp/KennaMain_cardmockup_2.jpg",
  "/projects/lbtp/KennaMain_cardmockup_1.jpg",
  "/projects/lbtp/KennaMain_StickerMockup.1.jpg",
  "/projects/book/book_illustrations.jpg",
  "/projects/book/bookcover.glb",
  "/projects/science_illustrations/cicada.jpg",
  "/projects/science_illustrations/marine_worm.jpg",
  "/projects/science_illustrations/lynx_spider.jpg",
  "/projects/science_illustrations/florida_insects.jpg",
  "/projects/newsletter/makingwherever.jpg",
  "/projects/newsletter/whoiam.jpg",
  "/projects/newsletter/front.jpg",
  "/projects/psa/psa_3.jpg",
  "/projects/psa/psa_2.jpg",
  "/projects/psa/psa_1.jpg",
]

export type Project = {
  title: string,
  description: string,
  thumbnail: string | undefined,
  files: string[]
}

export const projects: Project[] = [
  {
    title: "",
    description: "",
    thumbnail: undefined,
    files: [
      "/projects/patterns/main_w1 2.jpg",
      "/projects/patterns/pattern6.jpg",
      "/projects/patterns/horseshoecrab.jpg",
      "/projects/patterns/diatoms.jpg",
      "/projects/patterns/kennamain_pattern_1.jpg",
      "/projects/patterns/radiolarian.jpg",
      "/projects/patterns/cuttlefish.jpg",
    ]
  },
  {
    title: "",
    description: "",
    thumbnail: undefined,
    files: [
      "/projects/metamorphic/main_metamorphic.jpg",
      "/projects/metamorphic/TRANSFORMER poster.jpg",
      "/projects/metamorphic/shapeshifter poster.jpg",
      "/projects/metamorphic/metamorphic poster final.jpg",
    ]
  },
  {
    title: "",
    description: "",
    thumbnail: undefined,
    files: [
      "/projects/Gauache/main_poster_art.jpg",
    ]
  },
  {
    title: "",
    description: "",
    thumbnail: undefined,
    files: [
      "/projects/bookstore/bookposter2.jpg",
      "/projects/bookstore/bookposter3.jpg",
      "/projects/bookstore/bookposter1.jpg",
      "/projects/bookstore/Three_Posters_In_Metal_Frames.jpg",
    ]
  },
  {
    title: "",
    description: "",
    thumbnail: undefined,
    files: [
      "/projects/make a discovery/make4.jpg",
      "/projects/make a discovery/make5.jpg",
      "/projects/make a discovery/make7.jpg",
      "/projects/make a discovery/make6.jpg",
      "/projects/make a discovery/make2.jpg",
      "/projects/make a discovery/makefront.jpg",
      "/projects/make a discovery/make3.jpg",
      "/projects/make a discovery/IMG_7681.jpg",
      "/projects/make a discovery/IMG_7678.jpg",
      "/projects/make a discovery/make.glb",
    ]
  },
  {
    title: "",
    description: "",
    thumbnail: undefined,
    files: [
      "/projects/park wayfinding/softball4.jpg",
      "/projects/park wayfinding/softball3.jpg",
      "/projects/park wayfinding/softball2.jpg",
      "/projects/park wayfinding/softball1.jpg",
      "/projects/park wayfinding/park_signs.jpg",
    ]
  },
  {
    title: "",
    description: "",
    thumbnail: undefined,
    files: [
      "/projects/pompeiiworm_inforgraphic/pompeii infographic.pdf",
    ]
  },
  {
    title: "",
    description: "",
    thumbnail: undefined,
    files: [
      "/projects/lbtp/lbtp_direwolf_sticker.jpg",
      "/projects/lbtp/KennaMain_TshirtMockupfront_ 2.jpg",
      "/projects/lbtp/lbtp_poster.jpg",
      "/projects/lbtp/KennaMain_PinMockup.jpg",
      "/projects/lbtp/KennaMain_TicketMockup.jpg",
      "/projects/lbtp/lbtp_wordlockup.svg",
      "/projects/lbtp/KennaMain_TshirtMockupback_2.jpg",
      "/projects/lbtp/KennaMain_ToteBag_Mockup_2.jpg",
      "/projects/lbtp/lbtp_symbol.svg",
      "/projects/lbtp/KennaMain_Sticker_Mockup_2.jpg",
      "/projects/lbtp/KennaMain_ToteBag_Mockup_1.jpg",
      "/projects/lbtp/KennaMain_cardmockup_2.jpg",
      "/projects/lbtp/KennaMain_cardmockup_1.jpg",
      "/projects/lbtp/KennaMain_StickerMockup.1.jpg",
    ]
  },
  {
    title: "",
    description: "",
    thumbnail: undefined,
    files: [
      "/projects/book/book_illustrations.jpg",
      "/projects/book/bookcover.glb",
    ]
  },
  {
    title: "",
    description: "",
    thumbnail: undefined,
    files: [
      "/projects/science_illustrations/cicada.jpg",
      "/projects/science_illustrations/marine_worm.jpg",
      "/projects/science_illustrations/lynx_spider.jpg",
      "/projects/science_illustrations/florida_insects.jpg",
    ]
  },
  {
    title: "",
    description: "",
    thumbnail: undefined,
    files: [
      "/projects/newsletter/makingwherever.jpg",
      "/projects/newsletter/whoiam.jpg",
      "/projects/newsletter/front.jpg",
    ]
  },
  {
    title: "",
    description: "",
    thumbnail: undefined,
    files: [
      "/projects/psa/psa_3.jpg",
      "/projects/psa/psa_2.jpg",
      "/projects/psa/psa_1.jpg",
    ]
  },
]

export const fetchPortfolioFiles = async () => {
  const awsResourcesList = await fetchResourceTextFromAws("")
  console.log({awsResourcesList})
  const awsFilesList = awsResourcesList?.match(new RegExp("<Key>([^<]*)</Key>", "g"))?.map((key) => key.slice(5, key.length-6))
  if (!awsFilesList) throw new Error("Failed to fetch files list")

  const filesSplitByFolder = awsFilesList.map((filepath) => filepath.split("/"))
  const filesStructure = parseDirectory(filesSplitByFolder)

  return filesStructure
}

export async function fetchResourceTextFromAws(resourcePath: string) {
  const awsListRequest = await fetch("http://kennamainportfolio.s3.us-east-2.amazonaws.com/" + resourcePath)
  if (!awsListRequest?.body) throw new Error("Cant fetch resource " + resourcePath)

  const awsResourceList = await readableStreamToString(awsListRequest.body)
  return awsResourceList
}

export async function fetchJsonFromAWS<T>(resourcePath: string) {
  const text = await fetchResourceTextFromAws(resourcePath)
  return JSON.parse(text) as T
}

async function readableStreamToString(readableStream: ReadableStream) {
  const reader = readableStream.getReader();
  let result = '';
  const decoder = new TextDecoder();

  while (true) {
    const { done, value } = await reader.read();

    if (done) {
      break; // No more data to read
    }

    if (value) {
      result += decoder.decode(value, { stream: true }); // Decode the chunk and append
    }
  }

  // Final decode to handle any remaining buffered data
  result += decoder.decode();

  return result;
}


// Directory parsing

export type DirectoryMetadata = {
  thumbnail?: string // filename of the thumbnail for this directory
  title?: string
  description?: string
  spacerImageFilepath?: string // if set, will add spacer images. if not, won't
}


export type Directory = {
  files: string[]
  folders: DirectoryList
  pwd: string
}

type DirectoryList = {
  [name: string]: Directory
}

type UnprocessedFolders = {
  [name: string]: string[][]
}

const parseDirectory = (files: string[][], pwd: string = "/"): Directory => {
  const directory = {files: [] as string[], folders: {} as UnprocessedFolders}

  files.map((filePath: string[]) => {
    if (filePath.length < 1) return
    if (filePath.length === 1) {
      directory.files.push(filePath[0])
      return
    }

    const folder = filePath[0] as string
    filePath = filePath.slice(1)

    if (!directory.folders[folder]) {
      directory.folders[folder] = []
    }

    directory.folders[folder].push(filePath)
  })

  const directoryList = {} as DirectoryList
  Object.keys(directory.folders).forEach(folderName => {
    directoryList[folderName] = parseDirectory(directory.folders[folderName], pwd + folderName + "/")
  });

  return {
    files: directory.files,
    folders: directoryList,
    pwd
  }
}
